#!/bin/bash
# Корректирует зелёный канал гаммы в зависимости от яркости дисплея.
#
# При снижении яркости подсветки некоторые панели (например CSO SNE007ZA2-1)
# дают кислотный зелёный оттенок. Этот скрипт компенсирует сдвиг цвета,
# уменьшая зелёный канал гаммы пропорционально снижению яркости.
#
# Настройки ниже — подберите под свою панель.

# ── Настройки ──────────────────────────────────────────────
# Имя дисплея (узнать: xrandr --listmonitors)
DISPLAY_NAME="${DISPLAY_NAME:-eDP}"

# Путь к файлу яркости (узнать: ls /sys/class/backlight/)
BACKLIGHT="${BACKLIGHT:-/sys/class/backlight/amdgpu_bl1/brightness}"

# Максимальная яркость
MAX="${MAX:-255}"

# Порог яркости, ниже которого коррекция на максимуме (75% от MAX по умолчанию)
MID="${MID:-191}"

# Минимальное значение гаммы зелёного канала (сила коррекции)
# 0.70 = убрать 30% зелёного. Чем меньше — тем сильнее коррекция.
MIN_GAMMA="${MIN_GAMMA:-0.70}"
# ──────────────────────────────────────────────────────────

CUR=$(cat "$BACKLIGHT")

if [ "$CUR" -ge "$MAX" ]; then
    GAMMA_G="1.0"
elif [ "$CUR" -le "$MID" ]; then
    GAMMA_G="$MIN_GAMMA"
else
    GAMMA_G=$(echo "scale=4; $MIN_GAMMA + ($CUR - $MID) * (1.0 - $MIN_GAMMA) / ($MAX - $MID)" | bc)
fi

DISPLAY="${DISPLAY:-:0}" xrandr --output "$DISPLAY_NAME" --gamma "1.0:${GAMMA_G}:1.0"
